<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="wNameth=device-wNameth, initial-scale=1.0">
    <title>マイクラプレイヤーデータ</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <table>
        <thead>
            <tr>
                <td>プレイヤーID</td>
                <td>プレイヤー名</td>
                <td>ポジション</td>
            </tr>
        </thead>
        <tbody id="playerData">
            <!-- プレイヤーデータがここに動的に追加される -->
        </tbody>
    </table>
</body>
<script>
    const tbody = document.getElementById('playerData');
    let data = {};
    const ws = new WebSocket('wss://realtime-position-15b78e5f6699.herokuapp.com');

    // サーバーからデータを受信したときの処理
    ws.onmessage = (event) => {
        const eventData = JSON.parse(event.data); // サーバーからのデータはJSON形式と仮定
        console.log()
        for (const [Id, user_data] of Object.entries(eventData)) {
            if (Id == "header" || Id == "body") continue
            const exist_judge = user_data["exist"]
            const Name = user_data["Name"]
            const Posi = user_data["Posi"]
            if(exist_judge == "true"){
                data[Id] = [Name, `${Math.round(Posi.x)}, ${Math.round(Posi.y)}, ${Math.round(Posi.z)}`];
                console.log(`Id: ${Id} Name: ${Name},Posi: ${Posi.x}, ${Posi.y}, ${Posi.z}`)
            }
            if (exist_judge == "false"){
                delete data[Id]
            }
        };
        updateTable();  // データが更新されたらテーブルを更新
    };

    // テーブルを更新する関数
    function updateTable() {
        tbody.innerHTML = '';  // 現在のテーブルの内容をクリア
        // dataの内容をテーブルに反映
        Object.entries(data).forEach(([Id, list_data]) => {
            const tr = document.createElement('tr');  // 新しい行を作成
            const tdId = document.createElement('td'); // プレイヤーName用のセル
            tdId.textContent = Id;
            const tdName = document.createElement('td'); // プレイヤーName用のセル
            tdName.textContent = list_data[0];
            const tdPos = document.createElement('td'); // ポジション用のセル
            tdPos.textContent = list_data[1];
            tr.appendChild(tdId);  // 行にプレイヤーNameを追加
            tr.appendChild(tdName);  // 行にプレイヤーNameを追加
            tr.appendChild(tdPos); // 行にポジションを追加
            tbody.appendChild(tr); // 行をテーブルに追加
        });
    }
</script>

</html>