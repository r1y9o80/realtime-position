<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>マイクラプレイヤーデータ</title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <table>
            <thead>
                <tr>
                    <td>プレイヤーID</td>
                    <td>ポジション</td>
                </tr>
            </thead>
            <tbody id="playerData">
                <!-- プレイヤーデータがここに動的に追加される -->
            </tbody>
        </table>
    </body>
    <script>
        let data = {};
        const ws = new WebSocket('wss://realtime-position-15b78e5f6699.herokuapp.com');
        
        // サーバーからデータを受信したときの処理
        ws.onmessage = (event) => {
            const eventData = JSON.parse(event.data); // サーバーからのデータはJSON形式と仮定
            for(const [Id, Posi] of Object.entries(eventData)){
                if (Id == "header" || Id == "body") continue
                data[Id] = `${Math.round(Posi.x)}, ${Math.round(Posi.y)}, ${Math.round(Posi.z)}`;
                console.log(`Id: ${Id},Posi: ${Posi.x}, ${Posi.y}, ${Posi.z}`)
            };

            updateTable();  // データが更新されたらテーブルを更新
        };

        // テーブルを更新する関数
        function updateTable() {
            const tbody = document.getElementById('playerData');
            tbody.innerHTML = '';  // 現在のテーブルの内容をクリア

            // dataの内容をテーブルに反映
            Object.entries(data).forEach(([playerId, position]) => {
                const tr = document.createElement('tr');  // 新しい行を作成
                const tdId = document.createElement('td'); // プレイヤーID用のセル
                tdId.textContent = playerId;
                const tdPos = document.createElement('td'); // ポジション用のセル
                tdPos.textContent = position;
                tr.appendChild(tdId);  // 行にプレイヤーIDを追加
                tr.appendChild(tdPos); // 行にポジションを追加
                tbody.appendChild(tr); // 行をテーブルに追加
            });
        }
    </script>
</html>
